define(["zepto"], function ($) {

	var Data_BPMTaskCenterBillList = {
		"recordsTotal": 2,
		"recordsFilered": 2,
		"draw": 0,
		"data": [
			{
				"id": "bc61210d-6d3b-11e8-81e7-06980e00015d",
				"processDefinitionId": "eiap208794:2:5b8d86a0-6d21-11e8-b092-06980e00015d",
				"processDefinitionUrl": "http://172.20.8.87:8080/ubpm-web-rest/service/repository/process-definitions/eiap208794:2:5b8d86a0-6d21-11e8-b092-06980e00015d",
				"processInstanceId": "bc4f1f8b-6d3b-11e8-81e7-06980e00015d",
				"processInstanceUrl": "http://172.20.8.87:8080/ubpm-web-rest/service/history/historic-process-instances/bc4f1f8b-6d3b-11e8-81e7-06980e00015d",
				"executionId": "bc5adf79-6d3b-11e8-81e7-06980e00015d",
				"name": "01提交的【督办】,单号 是A180611006, 请审批",
				"keyFeature": null,
				"description": "agree",
				"deleteReason": "completed",
				"owner": null,
				"assignee": "bdf4816007974b13be7dc7568bef9bad",
				"startTime": 1528696396579,
				"endTime": 1528696554379,
				"durationInMillis": 157800,
				"workTimeInMillis": null,
				"claimTime": null,
				"taskDefinitionKey": "approveUserTask691",
				"formKey": null,
				"priority": 0,
				"dueDate": null,
				"parentTaskId": null,
				"url": "bc61210d-6d3b-11e8-81e7-06980e00015d",
				"variables": [
					{
						"name": "tenant_id",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "tenant",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "formId",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "a0cf1a12-89d1-4a1f-91b0-dcfedf0c3b23",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "billMarker",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "2750eac8e8084cd5bb99eb3c2ff19046",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "code",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "A180611006",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "kpi_level",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 1,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "serviceClass",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "/example/ygdemo_yw_info",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "initiator",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "2750eac8e8084cd5bb99eb3c2ff19046",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "kpi_flag",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 0,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "initiatorUserGroup",
						"type": null,
						"variableScope": "GLOBAL",
						"value": null,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "title",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "01提交的【督办】,单号 是A180611006, 请审批",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "zy_cd",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 1,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "orgId",
						"type": null,
						"variableScope": "GLOBAL",
						"value": null,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "dr",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 0,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "processDefinitionKey",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "eiap208794",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "formUrl",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "/example/pages/ygdemo_yw_info/ygdemo_yw_info.js",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "name",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "01-2",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "isManager",
						"type": "boolean",
						"variableScope": "GLOBAL",
						"value": false,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "initiatorDept",
						"type": null,
						"variableScope": "GLOBAL",
						"value": null,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "state",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 0,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "id",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "a0cf1a12-89d1-4a1f-91b0-dcfedf0c3b23",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "ly_code",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "1",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "billNo",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "A180611006",
						"valueUrl": null,
						"scope": "global"
					}
				],
				"tenantId": "default_tenant_id",
				"category": "default_tenant_id",
				"ownerParticipant": null,
				"processFinished": false,
				"finished": false,
				"state": "completed_processUnFinished",
				"processDefinitionName": "",
				"categoryResponse": null,
				"assigneeParticipant": null,
				"candidateParticipants": null,
				"historicProcessInstance": {
					"id": "bc4f1f8b-6d3b-11e8-81e7-06980e00015d",
					"url": "http://172.20.8.87:8080/ubpm-web-rest/service/history/historic-process-instances/bc4f1f8b-6d3b-11e8-81e7-06980e00015d",
					"businessKey": "a0cf1a12-89d1-4a1f-91b0-dcfedf0c3b23",
					"currentActivityId": null,
					"processDefinitionId": "eiap208794:2:5b8d86a0-6d21-11e8-b092-06980e00015d",
					"processDefinitionUrl": "http://172.20.8.87:8080/ubpm-web-rest/service/repository/process-definitions/eiap208794:2:5b8d86a0-6d21-11e8-b092-06980e00015d",
					"startTime": 1528696396460,
					"endTime": null,
					"durationInMillis": null,
					"startUserId": "2750eac8e8084cd5bb99eb3c2ff19046",
					"startActivityId": "startEvent9669",
					"endActivityId": null,
					"deleteReason": null,
					"superProcessInstanceId": null,
					"variables": [],
					"tenantId": "default_tenant_id",
					"name": "01提交的【督办】,单号 是A180611006, 请审批",
					"keyFeature": null,
					"state": null,
					"icon": null,
					"historicTasks": null,
					"tasks": null,
					"subHistoricProcessInstanceResponses": null,
					"historicActivityInstances": null,
					"executions": null,
					"bpmForms": null,
					"startParticipant": null,
					"processDefination": null,
					"bpmActivityForms": null,
					"copyUserParticipants": null,
					"hasTaskFinished": false,
					"withdrawAll": false,
					"formDataMap": null,
					"formDataList": null
				},
				"taskComments": null,
				"activity": null
			},
			{
				"id": "928d57d4-6d39-11e8-81e7-06980e00015d",
				"processDefinitionId": "eiap208794:2:5b8d86a0-6d21-11e8-b092-06980e00015d",
				"processDefinitionUrl": "http://172.20.8.87:8080/ubpm-web-rest/service/repository/process-definitions/eiap208794:2:5b8d86a0-6d21-11e8-b092-06980e00015d",
				"processInstanceId": "92572c82-6d39-11e8-81e7-06980e00015d",
				"processInstanceUrl": "http://172.20.8.87:8080/ubpm-web-rest/service/history/historic-process-instances/92572c82-6d39-11e8-81e7-06980e00015d",
				"executionId": "928875d0-6d39-11e8-81e7-06980e00015d",
				"name": "01提交的【督办】,单号 是A180611003, 请审批",
				"keyFeature": null,
				"description": "agree",
				"deleteReason": "completed",
				"owner": null,
				"assignee": "bdf4816007974b13be7dc7568bef9bad",
				"startTime": 1528695467412,
				"endTime": 1528696245513,
				"durationInMillis": 778101,
				"workTimeInMillis": null,
				"claimTime": null,
				"taskDefinitionKey": "approveUserTask691",
				"formKey": null,
				"priority": 0,
				"dueDate": null,
				"parentTaskId": null,
				"url": "928d57d4-6d39-11e8-81e7-06980e00015d",
				"variables": [
					{
						"name": "tenant_id",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "tenant",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "formId",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "e11bf6b1-ce20-4605-8913-535e1342c8db",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "billMarker",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "2750eac8e8084cd5bb99eb3c2ff19046",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "kpi_level",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 1,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "code",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "A180611003",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "serviceClass",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "/example/ygdemo_yw_info",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "initiator",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "2750eac8e8084cd5bb99eb3c2ff19046",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "kpi_flag",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 0,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "initiatorUserGroup",
						"type": null,
						"variableScope": "GLOBAL",
						"value": null,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "title",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "01提交的【督办】,单号 是A180611003, 请审批",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "zy_cd",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 1,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "orgId",
						"type": null,
						"variableScope": "GLOBAL",
						"value": null,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "dr",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 0,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "processDefinitionKey",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "eiap208794",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "formUrl",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "/example/pages/ygdemo_yw_info/ygdemo_yw_info.js",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "name",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "01-1",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "isManager",
						"type": "boolean",
						"variableScope": "GLOBAL",
						"value": false,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "initiatorDept",
						"type": null,
						"variableScope": "GLOBAL",
						"value": null,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "id",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "e11bf6b1-ce20-4605-8913-535e1342c8db",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "ly_code",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "1",
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "state",
						"type": "integer",
						"variableScope": "GLOBAL",
						"value": 0,
						"valueUrl": null,
						"scope": "global"
					},
					{
						"name": "billNo",
						"type": "string",
						"variableScope": "GLOBAL",
						"value": "A180611003",
						"valueUrl": null,
						"scope": "global"
					}
				],
				"tenantId": "default_tenant_id",
				"category": "default_tenant_id",
				"ownerParticipant": null,
				"processFinished": false,
				"finished": false,
				"state": "completed_processUnFinished",
				"processDefinitionName": "",
				"categoryResponse": null,
				"assigneeParticipant": null,
				"candidateParticipants": null,
				"historicProcessInstance": {
					"id": "92572c82-6d39-11e8-81e7-06980e00015d",
					"url": "http://172.20.8.87:8080/ubpm-web-rest/service/history/historic-process-instances/92572c82-6d39-11e8-81e7-06980e00015d",
					"businessKey": "e11bf6b1-ce20-4605-8913-535e1342c8db",
					"currentActivityId": null,
					"processDefinitionId": "eiap208794:2:5b8d86a0-6d21-11e8-b092-06980e00015d",
					"processDefinitionUrl": "http://172.20.8.87:8080/ubpm-web-rest/service/repository/process-definitions/eiap208794:2:5b8d86a0-6d21-11e8-b092-06980e00015d",
					"startTime": 1528695467058,
					"endTime": null,
					"durationInMillis": null,
					"startUserId": "2750eac8e8084cd5bb99eb3c2ff19046",
					"startActivityId": "startEvent9669",
					"endActivityId": null,
					"deleteReason": null,
					"superProcessInstanceId": null,
					"variables": [],
					"tenantId": "default_tenant_id",
					"name": "01提交的【督办】,单号 是A180611003, 请审批",
					"keyFeature": null,
					"state": null,
					"icon": null,
					"historicTasks": null,
					"tasks": null,
					"subHistoricProcessInstanceResponses": null,
					"historicActivityInstances": null,
					"executions": null,
					"bpmForms": null,
					"startParticipant": null,
					"processDefination": null,
					"bpmActivityForms": null,
					"copyUserParticipants": null,
					"hasTaskFinished": false,
					"withdrawAll": false,
					"formDataMap": null,
					"formDataList": null
				},
				"taskComments": null,
				"activity": null
			}
		],
		"statusCode": "200",
		"message": "操作成功"
	};
    
    var _bpm = {
		test:function(){
			console.log('iUAP BPM is ready!')
		},		
		bpmAjax:function(){
			console.log('iUAP BPM ajax')
			//alert($)
		},
		getBillList:function(result, ctx, callback){

		
			this.getDataByAjax('getTaskList65', ctx, function(ret){
				ret = Data_BPMTaskCenterBillList;//need modify
				if(ret.statusCode != 200){
					return;
				}
				
				var array = result.jsonDatas.getTaskList || result.jsonDatas.getTaskList65;
				var NC_billsArray = array[0].taskstructlist || [];
				
				var bpm_billsArray = [];
				for(var i=0,len=ret.data.length;i<len;i++){
					var bpm_bill = {};			
					var item = ret.data[i];
					
					bpm_bill["taskid"] = item.id;
					bpm_bill["title"] = item.name;
					bpm_bill["date"] = item.startTime?(new Date(item.startTime)).format("yyyy-MM-dd hh:mm:ss"):"";
					bpm_bill["billsrc"] = "bpmtaskcenter";//请假 bpmtaskcenter 的标识
					bpm_billsArray.push(bpm_bill);
				}
				array[0].taskstructlist = NC_billsArray.concat(bpm_billsArray);
				callback(result)
			}, true);
		},
		getDataByAjax: function (methodName, params, successCallBack, asyncValue) {
            //调用Ajax方法
            this.doAjax(params, successCallBack, asyncValue);
        },
		doAjax: function (params, successCallBack, asyncValue) {
            var url = "/umapp/reqdata?radom=" + Math.random();
            $.ajax({
                type: "post",
                url: url,
                data: JSON.stringify(params),
                async: asyncValue,
                dataType: 'text/plain',
                beforeSend: function (XMLHttpRequest) {
                    XMLHttpRequest.setRequestHeader("maurl", "112233");
                },
                contentType: 'application/json;charset=utf-8',
                success: function (result) {
					//eval("_billList." + successCallBack + "(" + result + ", "+JSON.stringify(param)+")");
					successCallBack(result);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    successCallBack({});
                }
            });
        },
		log:function(){
			alert('log');
		}
    };


    return _bpm;
});



////////////////////////////////////////////////////////////gct


if(Date.prototype.format){
	alert("Date.prototype.format is exist!")
	Date.prototype.__format = Date.prototype.format;
}
Date.prototype.format = function (format) {
        // (new Date()).format("yyyy-MM-dd hh:mm:ss")
        var o = {
            "M+": this.getMonth() + 1, //month
            "d+": this.getDate(), //day
            "h+": this.getHours(), //hour
            "m+": this.getMinutes(), //minute
            "s+": this.getSeconds(), //second
            "q+": Math.floor((this.getMonth() + 3) / 3), //quarter
            "S": this.getMilliseconds() //millisecond
        };

        if (/(y+)/.test(format)) {
            format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        }

        for (var k in o) {
            if (new RegExp("(" + k + ")").test(format)) {
                format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
            }
        }
        return format;
}